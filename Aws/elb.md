---
title: ELB
date: "2020-09-01T03:47:00.000Z"
description: "Elastic Load Balencing"
---


# Health Checks
 - they enable load balencers to check if the instances are available to forward traffic
 - healths checks are one on a port and a route /health 
    - if response is 200 then healthy otherwise unhealthy


# ELB - Elastic Load Balencer

- Load balencers are servers that fowared internet traffic to multiple server (ec2 instances)
- Types
    - Classic Load Balencer ( old generation )
        - HTTP, HTTPS, TCP
    - Application Load Balencer ( new generation )
        - HTTP, HTTPS, Websocket
    - Network Load Balencer ( new generation )
        - TCP, TLS, UDP
- Can set up 
    - internal load balencers ( private )
    - external load balencers ( public )
- load balencer security group configures the ports
- security groups of load balencers is used in security group of ec2 for permissions


# CLB - Classic Load Balencers
- TCP ( layer 4 )
- HTTP and HTTPS ( layer 7 ) 
- health check is tcp or https based
- fixed host name

#  ALB - Application Load Balencer
- HTTP And HTTPS ( layer 7 )
- load balencing to multiple applications on the same machine ( ex: containers )
- listerners can be redirect to different target groups
- support routing to different target groups
    - using path
    - host name
    - query string and headers
- target can be
    - ec2
    - ecs tasks
    - lambda functions
    - ip addresses ( private ips )
- fixed hostname
- applictions servers don't see the ip of the client directly
    - true ip is inserted in __X-Forwarded-For__ header
    - port in __X-Forwarded-Port__ 
    - protocol in __X-Forwarded-Proto__


# NLB - Network Load Balencers

- TCP or UPD based traffic ( layer 4 )
- less latency
- Expose one ip per AZ, helpfull for whitelisting specific IP 
- supports Elastic IP
- in ec2 security group we have to export the ip of the client instead of load balencer security group.

# Sticky Sessions

- same instances for same clients
- works for
    - ALB
    - CLB
- uses a cookie for the stickiness
- Applicaton based cookies
    - Custom cookies
        - can include any custom attributes required by the application
        - cookie name must be specified individually for each target group
        - dont use AWSALB, AWSALBAPP, AWSALBTG reserved by elb
    - Application cookie
        - Generated by load balencer
        - cookie name AWSALBAPP
- Duration- based cookies
    - generated by load balencer
    - cookie name AWSALB for ALB, AWSELB for CLB
- Target Groups -> Edit Attributes -> Enable Stickyness


# Cross Zone Load Balencing
- each load balencer instance distributes evenly across all registered instancess in all AZ
- Application Load Balencer
    - always enabled ( cannot be disabled)
    - not extra charges for inter AZ data
- Network Load Balencer
    - Disabled by default
    - pay extra for inter AZ data if enabled
- Classic Load Balencer
    - created Through console -> enabled by default
    - created through Through CLI/API -> Disabled by default
    - No charges for inter AZ data if enabled

# SSL - Server Name Indication

- solves the problem of loading multiple certificates on to one web server 
- newer protocol and required the client to indicate the hostname of the target server in the initial hand shake
- only works for ALB and NLB, CloudFront  

# Connnection Draining
- CLB - Connection Draining
- Target Group - Deregisration delay (ALB ,NLB)
- time to complete in-flight requests while instance is de-registaring or unhealty
- stops sending new request to the instance while registing
- deregistration delay between 1 to 3600 seconds, default 300 seconds
- disable it by setting the value as 0


 








